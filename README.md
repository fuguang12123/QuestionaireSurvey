# é—®å·è°ƒæŸ¥ç³»ç»Ÿ (QuestionaireSurvey)

ä¸€ä¸ªåŸºäº Spring Boot + MyBatis + MySQL çš„ç°ä»£åŒ–é—®å·è°ƒæŸ¥ç³»ç»Ÿåç«¯ï¼Œæ”¯æŒå¤šç§é¢˜å‹ã€ç”¨æˆ·ç®¡ç†ã€æ•°æ®ç»Ÿè®¡å’Œæ–‡ä»¶ä¸Šä¼ ç­‰åŠŸèƒ½ã€‚

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„é—®å·è°ƒæŸ¥ç³»ç»Ÿåç«¯ï¼Œæä¾›äº†ä»é—®å·åˆ›å»ºã€å‘å¸ƒã€ç­”é¢˜åˆ°æ•°æ®ç»Ÿè®¡çš„å®Œæ•´æµç¨‹ã€‚ç³»ç»Ÿé‡‡ç”¨å‰åç«¯åˆ†ç¦»æ¶æ„ï¼Œæ”¯æŒå¤šç”¨æˆ·ã€æƒé™ç®¡ç†å’Œæ•°æ®å¯¼å‡ºç­‰ä¼ä¸šçº§åŠŸèƒ½ã€‚

## ğŸš€ æ ¸å¿ƒåŠŸèƒ½

### ç”¨æˆ·ç®¡ç†
- **ç”¨æˆ·æ³¨å†Œ/ç™»å½•**: åŸºäºJWTçš„èº«ä»½è®¤è¯
  - **è§’è‰²æƒé™**: æ”¯æŒæ™®é€šç”¨æˆ·(USER)å’Œç®¡ç†å‘˜(ADMIN)è§’è‰²
  - **ä¸ªäººèµ„æ–™**: ç”¨æˆ·å¯æ›´æ–°ä¸ªäººä¿¡æ¯ã€å¯†ç å’Œå¤´åƒ
  - **ç”¨æˆ·çŠ¶æ€ç®¡ç†**: ç®¡ç†å‘˜å¯ç®¡ç†ç”¨æˆ·çŠ¶æ€

### é—®å·ç®¡ç†
- **é—®å·åˆ›å»º**: æ”¯æŒåˆ›å»ºå¤šç§ç±»å‹çš„é—®å·
  - **é—®å·ç±»å‹**:
      - å…¬å¼€é—®å·(PUBLIC): ä»»ä½•äººéƒ½å¯ä»¥è®¿é—®
      - ç§æœ‰é—®å·(PRIVATE): éœ€è¦è®¿é—®ç 
  - **é—®å·çŠ¶æ€**: è‰ç¨¿(0)ã€å‘å¸ƒ(1)ã€ç»“æŸ(2)ã€åˆ é™¤(3)
  - **é—®å·è®¾ç½®**: æ”¯æŒå¼€å§‹/ç»“æŸæ—¶é—´ã€è®¿é—®æ§åˆ¶ç­‰

### é¢˜ç›®ç±»å‹
- **å•é€‰é¢˜(RADIO)**: å•é¡¹é€‰æ‹©
  - **å¤šé€‰é¢˜(CHECKBOX)**: å¤šé¡¹é€‰æ‹©
  - **æ–‡æœ¬é¢˜(TEXT)**: æ–‡æœ¬è¾“å…¥
  - **è¯„åˆ†é¢˜(RATING)**: è¯„åˆ†é€‰æ‹©
  - **æ–‡ä»¶é¢˜(FILE)**: æ–‡ä»¶ä¸Šä¼ 

### ç­”é¢˜åŠŸèƒ½
- **åŒ¿åç­”é¢˜**: æ”¯æŒåŒ¿åç”¨æˆ·å‚ä¸
  - **ç™»å½•ç­”é¢˜**: æ³¨å†Œç”¨æˆ·å¯ç™»å½•åç­”é¢˜
  - **è®¿é—®æ§åˆ¶**: ç§æœ‰é—®å·éœ€è¦è®¿é—®ç 
  - **è®¾å¤‡ä¿¡æ¯**: è®°å½•ç­”é¢˜è€…IPå’Œè®¾å¤‡ä¿¡æ¯

### æ•°æ®ç»Ÿè®¡
- **ç»Ÿè®¡åˆ†æ**: è‡ªåŠ¨ç”Ÿæˆé—®å·ç»Ÿè®¡æŠ¥å‘Š
  - **é€‰æ‹©é¢˜ç»Ÿè®¡**: é€‰é¡¹åˆ†å¸ƒç»Ÿè®¡
  - **åŸå§‹æ•°æ®**: æŸ¥çœ‹æ¯ä¸ªé—®é¢˜çš„åŸå§‹ç­”æ¡ˆ
  - **æ•°æ®å¯¼å‡º**: æ”¯æŒCSVæ ¼å¼æ•°æ®å¯¼å‡º

### æ–‡ä»¶ç®¡ç†
- **é˜¿é‡Œäº‘OSS**: é›†æˆé˜¿é‡Œäº‘å¯¹è±¡å­˜å‚¨
  - **æ–‡ä»¶ä¸Šä¼ **: æ”¯æŒ10MBä»¥å†…æ–‡ä»¶ä¸Šä¼ 
  - **æ–‡ä»¶ç»„ç»‡**: æŒ‰æ—¥æœŸè‡ªåŠ¨åˆ†ç±»å­˜å‚¨

## ğŸ›  æŠ€æœ¯æ ˆ

### åç«¯æ¡†æ¶
- **Spring Boot 3.4.6**: ä¸»æ¡†æ¶
  - **Spring Security**: å®‰å…¨è®¤è¯
  - **MyBatis 3.0.4**: æ•°æ®æŒä¹…åŒ–
  - **PageHelper**: åˆ†é¡µæ’ä»¶

### æ•°æ®åº“
- **MySQL**: ä¸»æ•°æ®åº“
  - **Redis**: ç¼“å­˜(é…ç½®ä¸­)
  - **Druid**: æ•°æ®åº“è¿æ¥æ± 

### è®¤è¯æˆæƒ
- **JWT (JSON Web Token)**: æ— çŠ¶æ€è®¤è¯
  - **BCrypt**: å¯†ç åŠ å¯†

### æ–‡ä»¶å­˜å‚¨
- **é˜¿é‡Œäº‘OSS**: å¯¹è±¡å­˜å‚¨æœåŠ¡

### å¼€å‘å·¥å…·
- **Lombok**: ç®€åŒ–Javaä»£ç 
  - **Jackson**: JSONå¤„ç†

## ğŸ“ é¡¹ç›®ç»“æ„

```
src/main/java/com/example/survey/
â”œâ”€â”€ QuestionaireSurveyApplication.java    # ä¸»å¯åŠ¨ç±»
â”œâ”€â”€ common/                               # é€šç”¨ç»„ä»¶
â”‚   â”œâ”€â”€ GlobalExceptionHandler.java       # å…¨å±€å¼‚å¸¸å¤„ç†
â”‚   â””â”€â”€ Result.java                       # ç»Ÿä¸€å“åº”æ ¼å¼
â”œâ”€â”€ config/                               # é…ç½®ç±»
â”‚   â”œâ”€â”€ SecurityConfig.java               # Spring Securityé…ç½®
â”‚   â”œâ”€â”€ JwtRequestFilter.java             # JWTè¿‡æ»¤å™¨
â”‚   â””â”€â”€ JwtAuthenticationEntryPoint.java  # JWTè®¤è¯å…¥å£
â”œâ”€â”€ controller/                           # æ§åˆ¶å™¨å±‚
â”‚   â”œâ”€â”€ AuthController.java               # è®¤è¯æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ UserController.java               # ç”¨æˆ·ç®¡ç†
â”‚   â”œâ”€â”€ SurveyController.java             # é—®å·ç®¡ç†
â”‚   â”œâ”€â”€ QuestionController.java           # é¢˜ç›®ç®¡ç†
â”‚   â”œâ”€â”€ SubmissionController.java         # ç­”é¢˜æäº¤
â”‚   â”œâ”€â”€ StatsController.java              # æ•°æ®ç»Ÿè®¡
â”‚   â”œâ”€â”€ AdminController.java              # ç®¡ç†å‘˜åŠŸèƒ½
â”‚   â”œâ”€â”€ FileUploadController.java         # æ–‡ä»¶ä¸Šä¼ 
â”‚   â””â”€â”€ dto/                              # æ•°æ®ä¼ è¾“å¯¹è±¡
â”œâ”€â”€ entity/                               # å®ä½“ç±»
â”‚   â”œâ”€â”€ User.java                         # ç”¨æˆ·å®ä½“
â”‚   â”œâ”€â”€ Survey.java                       # é—®å·å®ä½“
â”‚   â”œâ”€â”€ Question.java                     # é¢˜ç›®å®ä½“
â”‚   â”œâ”€â”€ ResponseHeader.java               # ç­”å·å¤´å®ä½“
â”‚   â”œâ”€â”€ ResponseDetail.java               # ç­”å·è¯¦æƒ…å®ä½“
â”‚   â””â”€â”€ AliyunOssProperity.java          # OSSé…ç½®å®ä½“
â”œâ”€â”€ mapper/                               # MyBatisæ˜ å°„æ¥å£
â”‚   â”œâ”€â”€ UserMapper.java
â”‚   â”œâ”€â”€ SurveyMapper.java
â”‚   â”œâ”€â”€ QuestionMapper.java
â”‚   â”œâ”€â”€ ResponseHeaderMapper.java
â”‚   â””â”€â”€ ResponseDetailMapper.java
â”œâ”€â”€ service/                              # æœåŠ¡å±‚
â”‚   â”œâ”€â”€ UserService.java
â”‚   â”œâ”€â”€ SurveyService.java
â”‚   â”œâ”€â”€ QuestionService.java
â”‚   â”œâ”€â”€ SubmissionService.java
â”‚   â”œâ”€â”€ StatsService.java
â”‚   â”œâ”€â”€ AdminService.java
â”‚   â”œâ”€â”€ StorageService.java
â”‚   â””â”€â”€ ServiceImpl/                      # æœåŠ¡å®ç°
â”œâ”€â”€ utils/                                # å·¥å…·ç±»
â”‚   â”œâ”€â”€ JwtTokenUtil.java                 # JWTå·¥å…·
â”‚   â””â”€â”€ AliyunOSSOperator.java           # OSSæ“ä½œå·¥å…·
â””â”€â”€ exception/                            # è‡ªå®šä¹‰å¼‚å¸¸
    â”œâ”€â”€ ResourceNotFoundException.java
    â”œâ”€â”€ ForbiddenException.java
    â”œâ”€â”€ InvalidRequestException.java
    â”œâ”€â”€ InvalidSubmissionDataException.java
    â””â”€â”€ TooManyRequestsException.java
```

## ğŸ—„ æ•°æ®åº“è®¾è®¡

### æ ¸å¿ƒè¡¨ç»“æ„

#### ç”¨æˆ·è¡¨ (user)
- `id`: ä¸»é”®
  - `username`: ç”¨æˆ·å
  - `password`: åŠ å¯†å¯†ç 
  - `email`: é‚®ç®±
  - `avatar`: å¤´åƒURL
  - `role`: è§’è‰²(USER/ADMIN)
  - `status`: çŠ¶æ€(0-æ­£å¸¸/1-å—é™)
  - `created_at/updated_at`: æ—¶é—´æˆ³

#### é—®å·è¡¨ (survey)
- `id`: ä¸»é”®
  - `title`: é—®å·æ ‡é¢˜
  - `description`: é—®å·æè¿°
  - `creator_id`: åˆ›å»ºè€…ID
  - `type`: ç±»å‹(PUBLIC/PRIVATE)
  - `access_code`: è®¿é—®ç 
  - `status`: çŠ¶æ€(0-è‰ç¨¿/1-å‘å¸ƒ/2-ç»“æŸ/3-åˆ é™¤)
  - `start_time/end_time`: æœ‰æ•ˆæ—¶é—´
  - `settings`: JSONé…ç½®
  - `created_at/updated_at`: æ—¶é—´æˆ³

#### é¢˜ç›®è¡¨ (question)
- `id`: ä¸»é”®
  - `survey_id`: æ‰€å±é—®å·ID
  - `content`: é¢˜ç›®å†…å®¹(JSON)
  - `type`: é¢˜ç›®ç±»å‹(RADIO/CHECKBOX/TEXT/RATING/FILE)
  - `is_required`: æ˜¯å¦å¿…ç­”
  - `options`: é€‰é¡¹(JSON)
  - `logic`: é€»è¾‘é…ç½®(JSON)
  - `sort_order`: æ’åº
  - `created_at`: åˆ›å»ºæ—¶é—´

#### ç­”å·å¤´è¡¨ (response_header)
- `id`: ä¸»é”®
  - `survey_id`: é—®å·ID
  - `session_id`: ä¼šè¯ID
  - `user_id`: ç”¨æˆ·ID(å¯ä¸ºç©º)
  - `ip_address`: IPåœ°å€
  - `device_info`: è®¾å¤‡ä¿¡æ¯
  - `submitted_at`: æäº¤æ—¶é—´

#### ç­”å·è¯¦æƒ…è¡¨ (response_detail)
- `id`: ä¸»é”®
  - `response_id`: ç­”å·å¤´ID
  - `question_id`: é¢˜ç›®ID
  - `answer_data`: ç­”æ¡ˆæ•°æ®(JSON)
  - `created_at`: åˆ›å»ºæ—¶é—´

## ğŸ”Œ API æ¥å£

### è®¤è¯æ¥å£ (/api/auth)
- `POST /register` - ç”¨æˆ·æ³¨å†Œ
  - `POST /login` - ç”¨æˆ·ç™»å½•

### ç”¨æˆ·æ¥å£ (/api/users)
- `GET /me` - è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
  - `PUT /me` - æ›´æ–°ç”¨æˆ·èµ„æ–™
  - `PUT /me/password` - ä¿®æ”¹å¯†ç 
  - `PUT /me/username` - ä¿®æ”¹ç”¨æˆ·å

### é—®å·æ¥å£ (/api/surveys)
- `POST /` - åˆ›å»ºé—®å·
  - `GET /user` - è·å–å½“å‰ç”¨æˆ·çš„é—®å·åˆ—è¡¨
  - `GET /public` - è·å–å…¬å¼€é—®å·åˆ—è¡¨
  - `GET /{id}` - è·å–é—®å·è¯¦æƒ…
  - `GET /{id}/details` - è·å–å…¬å¼€é—®å·è¯¦æƒ…(ä¾›ç­”é¢˜)
  - `GET /{surveyId}/responses` - è·å–é—®å·å›ç­”åˆ—è¡¨

### é¢˜ç›®æ¥å£ (/api/surveys/{surveyId}/questions)
- `POST /batch` - æ‰¹é‡æ·»åŠ é¢˜ç›®
  - `PUT /{questionId}` - æ›´æ–°é¢˜ç›®
  - `DELETE /{questionId}` - åˆ é™¤é¢˜ç›®

### ç­”é¢˜æ¥å£ (/api/submit)
- `POST /{surveyId}` - æäº¤é—®å·ç­”æ¡ˆ

### ç»Ÿè®¡æ¥å£ (/api/stats)
- `GET /survey/{surveyId}` - è·å–é—®å·ç»Ÿè®¡
  - `GET /survey/{surveyId}/export` - å¯¼å‡ºé—®å·æ•°æ®
  - `GET /survey/{surveyId}/question/{questionId}/answers` - è·å–é¢˜ç›®åŸå§‹ç­”æ¡ˆ

### ç®¡ç†å‘˜æ¥å£ (/api/admin)
- `GET /users` - è·å–ç”¨æˆ·åˆ—è¡¨
  - `PATCH /users/{id}/status` - æ›´æ–°ç”¨æˆ·çŠ¶æ€
  - `GET /surveys` - è·å–æ‰€æœ‰é—®å·
  - `DELETE /surveys/{id}` - åˆ é™¤é—®å·

### æ–‡ä»¶ä¸Šä¼ æ¥å£ (/api/upload)
- `POST /` - ä¸Šä¼ æ–‡ä»¶

## âš™ï¸ é…ç½®è¯´æ˜

### æ•°æ®åº“é…ç½®
```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/web
    username: [æ•°æ®åº“ç”¨æˆ·å]
    password: [æ•°æ®åº“å¯†ç ]
```

### JWTé…ç½®
```yaml
jwt:
  secret: [JWTå¯†é’¥]
  expiration: 360000  # è¿‡æœŸæ—¶é—´(æ¯«ç§’)
```

### é˜¿é‡Œäº‘OSSé…ç½®
```yaml
aliyun:
  oss:
    endpoint: [OSSç«¯ç‚¹]
    bucketname: [å­˜å‚¨æ¡¶åç§°]
    region: [åŒºåŸŸ]
```

### Redisé…ç½®
```yaml
redis:
  host: localhost
  port: 6379
```

## ğŸ”’ å®‰å…¨ç‰¹æ€§

- **JWTè®¤è¯**: æ— çŠ¶æ€çš„ç”¨æˆ·è®¤è¯
  - **å¯†ç åŠ å¯†**: ä½¿ç”¨BCryptåŠ å¯†å­˜å‚¨
  - **CORSæ”¯æŒ**: è·¨åŸŸèµ„æºå…±äº«é…ç½®
  - **æƒé™æ§åˆ¶**: åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶
  - **å¼‚å¸¸å¤„ç†**: å…¨å±€å¼‚å¸¸å¤„ç†æœºåˆ¶

## ğŸ“Š ç‰¹è‰²åŠŸèƒ½

### 1. çµæ´»çš„é¢˜ç›®ç³»ç»Ÿ
- æ”¯æŒå¤šç§é¢˜ç›®ç±»å‹
  - JSONæ ¼å¼å­˜å‚¨é¢˜ç›®å†…å®¹å’Œé€‰é¡¹
  - æ”¯æŒé¢˜ç›®é€»è¾‘é…ç½®

### 2. å®Œå–„çš„ç»Ÿè®¡åˆ†æ
- å®æ—¶ç»Ÿè®¡æ•°æ®
  - é€‰æ‹©é¢˜è‡ªåŠ¨ç»Ÿè®¡é€‰é¡¹åˆ†å¸ƒ
  - æ”¯æŒåŸå§‹æ•°æ®æŸ¥çœ‹å’Œå¯¼å‡º

### 3. å¤šç§Ÿæˆ·æ”¯æŒ
- ç”¨æˆ·éš”ç¦»çš„é—®å·ç®¡ç†
  - å…¬å¼€/ç§æœ‰é—®å·è®¿é—®æ§åˆ¶
  - ç®¡ç†å‘˜å…¨å±€ç®¡ç†åŠŸèƒ½

### 4. æ–‡ä»¶å¤„ç†
- é›†æˆé˜¿é‡Œäº‘OSS
  - è‡ªåŠ¨æ–‡ä»¶åˆ†ç±»å­˜å‚¨
  - æ”¯æŒå¤šç§æ–‡ä»¶æ ¼å¼

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- Java 17+
  - MySQL 8.0+
  - Maven 3.6+
  - Redis (å¯é€‰)

### è¿è¡Œæ­¥éª¤
1. å…‹éš†é¡¹ç›®åˆ°æœ¬åœ°
   2. åˆ›å»ºMySQLæ•°æ®åº“ `web`
   3. é…ç½® `application.yml` ä¸­çš„æ•°æ®åº“è¿æ¥
   4. é…ç½®JWTå¯†é’¥å’Œé˜¿é‡Œäº‘OSSå‚æ•°
   5. è¿è¡Œ `mvn spring-boot:run`

### é»˜è®¤ç«¯å£
- åº”ç”¨ç«¯å£: 8080
  - æ•°æ®åº“ç«¯å£: 3306
  - Redisç«¯å£: 6379

## ğŸ“ å¼€å‘è¯´æ˜

### ä»£ç è§„èŒƒ
- ä½¿ç”¨Lombokç®€åŒ–ä»£ç 
  - ç»Ÿä¸€çš„Resultå“åº”æ ¼å¼
  - å®Œå–„çš„å¼‚å¸¸å¤„ç†æœºåˆ¶
  - è¯¦ç»†çš„æ¥å£æ–‡æ¡£æ³¨é‡Š

### æµ‹è¯•
- åŒ…å«å•å…ƒæµ‹è¯•ç”¨ä¾‹
  - ä½¿ç”¨Spring Boot Testæ¡†æ¶
  - æ•°æ®åº“æ“ä½œæµ‹è¯•è¦†ç›–

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
   2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯
   3. æäº¤æ›´æ”¹
   4. æ¨é€åˆ°åˆ†æ”¯
   5. åˆ›å»º Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š
- æäº¤ Issue
  - å‘é€é‚®ä»¶
  - åˆ›å»º Pull Request

---

**æ³¨æ„**: åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨å‰ï¼Œè¯·ç¡®ä¿ï¼š
1. ä¿®æ”¹é»˜è®¤çš„JWTå¯†é’¥
   2. é…ç½®æ­£ç¡®çš„æ•°æ®åº“è¿æ¥
   3. è®¾ç½®é˜¿é‡Œäº‘OSSè®¿é—®å‡­è¯
   4. å¯ç”¨HTTPS
   5. é…ç½®é€‚å½“çš„æ—¥å¿—çº§åˆ«
